function DataBox(){const t=this;function e(){}function n(){return!0}function r(t){return t?t.length:0}function i(e,n,r){return e.splice(n,r),t}function u(t,e){return t==e?0:t<e?-1:1}var o,a,s;function c(t,e,n){var r={id:n,data:e,childnodes:[]};return r.level=t.level+1,s(t,r)?(t.childnodes.push(r),r):null}this.size=r,this.indexOf=function(t,e){return t?t.indexOf(e):-1},this.intersect=function(t,e){return e?t.filter(function(t){return e.indexOf(t)>-1}):[]},this.multisort=function(t,e,n){return t.sort(function(t,r){return function t(e,n,r,i,o){var a=r[o=o||0],s=i&&"asc"==i[o]?u(e[a],n[a]):u(n[a],e[a]);return 0==s&&o<r.length-1?t(e,n,r,i,o+1):s}(t,r,e,n)})},this.swap=function(e,n,r){let i=e[n];return e[n]=e[r],e[r]=i,t},this.shuffle=function(t){return t.sort(function(){return.5-Math.random()})},this.add=function(t,e){return t&&t.push(e),e},this.addAt=function(t,e,n){return t&&t.splice(n,0,e),e},this.put=function(e,n){return e&&e.unshift(n),t},this.putAt=function(e,n,r){return t.addAt(e,n,r),t},this.push=function(e,n){return e&&e.push(n),t},this.remove=function(t,e,n){return t&&i(t,e,n)},this.reset=function(e){return e&&e.splice(0),t},this.pop=function(t){return t&&i(t,-1,1)},this.last=function(e){return t.get(e,r(e)-1)},this.get=function(t,e){return t&&t[e]},this.find=function(t,e){return t?t.find(e):null},this.ifind=function(t,e){return t?t.findIndex(e):-1},this.distinct=function(t,e){return e?t.filter((n,r)=>t.findIndex(t=>e(n,t))==r):t},this.isect=function(t,e,n){return e&&n?t.filter(t=>e.findIndex(e=>n(t,e))>=0):t},this.usect=function(t,e,n){return e&&n?t.concat(e.filter(e=>t.findIndex(t=>n(t,e))<0)):t},this.sortBy=function(e,n){return n?t.sort(e,(t,e)=>u(t[n],e[n])):e},this.sort=function(t,e){return t?t.sort(e||u):t},this.clone=function(t){return t?t.slice():[]},this.each=function(e,n){let i=r(e);for(let t=0;t<i;t++)n(e[t],t);return t},this.extract=function(e,n){let u=r(e);for(let t=0;t<u;t++)n(e[t],t)&&i(e,t--,1);return t},this.preorder=function(n,r,i){return function e(n,r,i,u){return r.childnodes.forEach((t,o)=>{i(n,r,t,o)&&e(n,t,i,u),u(n,r,t,o)}),t}(n,n,r,i||e)},this.findNode=function(e,n,r){var i;for(let u=0;!i&&u<n.childnodes.length;u++){let o=n.childnodes[u];i=r(e,n,o,u)?o:t.findNode(e,o,r)}return i},this.reduce=function(t,e){s=e||n;let i=[],u=r(t);u>0&&i.push(t[0]);for(let e=1;e<u;e++){let n=t[e],r=i[i.length-1];s(r,n,e,i)&&i.push(n)}return i},this.group=function(t,e){return e=Object.assign({id:0,level:0,data:[],childnodes:[]},e),s=e.onGroup||n,e.data.forEach(function(n,r){var i=e;t.forEach(function(t,e){var r=n[t];i=i.childnodes.find(t=>t.id==r)||c(i,i.data.filter(e=>e[t]==r),r)||i})}),e},this.tree=function(t,e){return e=Object.assign({id:0,level:0,childnodes:[]},e),o=e.pk||"id",a=e.fk||"parent",s=e.onGroup||n,e.data=t.filter(t=>!t[a]),e.data.forEach(n=>{!function t(e,n,r){var i=c(n,e.filter(t=>t[a]==r),r);return i&&i.data.forEach(n=>{t(e,i,n[o])}),i}(t,e,n[o])}),e};var l=[];this.graph=function(t,e){return e=Object.assign({id:0,level:0,childnodes:[]},e),l.slice(0),o=e.pk||"id",a=e.fk||"parent",s=e.onGroup||n,e.data=t.filter(t=>!t[a]),e.data.forEach(n=>{!function t(e,n,r){if(l.indexOf(r)>-1)return null;l.push(r);var i=c(n,e.filter(t=>t[a]==r),r);return i&&i.data.forEach(n=>{t(e,i,n[o])}),i}(t,e,n[o])}),e},this.bfs=function(t,e){l.slice(0),l.push(t.id);for(var n=[t];n.length>0;){let r=n.shift();n=r.childnodes.filter((n,i)=>{return l.indexOf(n.id)<0&&e(t,r,n,i)?l.push(n.id):0}).concat(n)}return t},this.findVertex=function(t,e){return l.slice(0),function t(e,n,r){if(l.indexOf(n.id)>-1)return null;var i;l.push(n.id);for(let u=0;!i&&u<n.childnodes.length;u++){let o=n.childnodes[u];i=r(e,n,o,u)?o:t(e,o,r)}return i}(t,t,e)}}function DateBox(t){const e=this,n=new Date,r=new Date,i=[31,28,31,30,31,30,31,31,30,31,30,31];function u(t){return parseInt(t)||0}function o(t,e){return function(t){return void 0!==t&&null!=t}(t)?t:e}function a(t){return+t<10?"0"+t:t}function s(t){return 0==(3&t)&&(t%25!=0||0==(15&t))}function c(t,e){return i[e]+(1==e&&s(t))}function l(t){return t?t.split(/\D+/):[]}function f(t,e,n){return Math.min(Math.max(u(t),e),n)}function h(t){return f(t,0,59)}function d(t,e,n,r,i){return t&&t.setHours(f(e,0,23),h(n),h(r),i),t}function m(t,r,i,u){var a;return t&&t.setFullYear((a=r)<100?100*e.getCentury()+a:o(a,n.getFullYear()),f(i,1,12)-1,f(u,1,c(r,+i-1))),t}function g(t,e,n,r,i,u,o,a){return d(m(t,e,n,r),i||0,u||0,o||0,a||0)}function p(t){return a(t.getHours())+":"+a(t.getMinutes())}function b(t){return p(t)+":"+a(t.getSeconds())}const y={en:{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"yy-mm-dd",firstDay:1,setDateTime:function(t,e,n,r,i,u,o,a){return g(t,e,n,r,i,u,o,a),this},build:function(t){return g(new Date,t[0],t[1],t[2],t[3],t[4],t[5],t[6])},toDate:function(t){return t&&this.build(l(t))},parse:function(t){return t&&isNaN(t)?Date.parse(t):new Date(+t)},helper:function(t){return t&&t.replace(/^(\d{4})(\d+)$/g,"$1-$2").replace(/^(\d{4}\-\d\d)(\d+)$/g,"$1-$2").replace(/[^\d\-]/g,"")},setAll:function(t,e){return this.setDateTime(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6])},trIsoDate:function(t){return t?this.setAll(r,l(t)).isoDate(r):t},acDate:function(t){return t?this.setAll(r,l(t)).isoDate(r):t},isoDate:function(t){return t.getFullYear()+"-"+a(t.getMonth()+1)+"-"+a(t.getDate())},isoTime:b,isoDateTime:function(t){return this.isoDate(t)+" "+this.isoTime(t)}},es:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Juv","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],dateFormat:"dd/mm/yy",firstDay:1,setDateTime:function(t,e,n,r,i,u,o,a){return g(t,e,n,r,i,u,o,a),this},build:function(t){return g(new Date,t[2],t[1],t[0],t[3],t[4],t[5],t[6])},toDate:function(t){return t&&this.build(l(t))},parse:function(t){return t&&isNaN(t)?Date.parse(t):new Date(+t)},helper:function(t){return t&&t.replace(/^(\d\d)(\d+)$/g,"$1/$2").replace(/^(\d\d\/\d\d)(\d+)$/g,"$1/$2").replace(/[^\d\/]/g,"")},setAll:function(t,e){return this.setDateTime(t,e[2],e[1],e[0],e[3],e[4],e[5],e[6])},trIsoDate:function(t){return t?this.setAll(r,(e=l(t),n=e[2],e[2]=e[0],e[0]=n,e)).isoDate(r):t;var e,n},acDate:function(t){return t?this.setAll(r,l(t)).isoDate(r):t},isoDate:function(t){return a(t.getDate())+"/"+a(t.getMonth()+1)+"/"+t.getFullYear()},isoTime:b,isoDateTime:function(t){return this.isoDate(t)+" "+this.isoTime(t)}},fr:{monthNames:["Janvier","Fevrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Decembre"],monthNamesShort:["Jan","Fev","Mar","Avr","Mai","Jun","Jul","Aou","Sep","Oct","Nov","Dec"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],dateFormat:"mm/dd/yy",firstDay:1},it:{monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gio","Ve","Sa"],dateFormat:"dd/mm/yy",firstDay:1},de:{monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],dateFormat:"yy-mm-dd",firstDay:1}};var v=y.es;function D(t,e){return r.setFullYear(t,e,1),r.getDay()}function M(t,n){return function(t,e){return t.replace(/@(\w+);/g,(t,n)=>o(e[n],t))}(t,e.toObject(n))}this.sysdate=function(){return n},this.getLang=function(t){return t?y[t]:v},this.setLang=function(t,n){return y[t]=n,e},this.getI18n=function(t){return y[t]||t&&y[t.substr(0,2)]||y.es},this.setI18n=function(t){return v=e.getI18n(t),e},this.valid=function(t){return t&&t instanceof Date&&!isNaN(t.getTime())},this.setTime=function(t,n,r,i,u){return d(t,n,r,i,u),e},this.setDate=function(t,n,r,i){return m(t,n,r,i),e},this.setDateTime=function(t,n,r,i,u,o,a,s){return e.setDate(t,n,r,i).setTime(t,u,o,a,s)},this.setAll=function(t,n){return v.setAll(t,n),e},this.build=function(t){return v.build(t)},this.load=function(t,n){return e.setDate(t,n.yyyy,n.m,n.d,n.h,n.M,n.s,n.ms)},this.init=function(t,r){return t&&t.setTime((r||n).getTime()),e},this.trunc=function(t){return e.setTime(t,0,0,0,0)},this.clone=function(t){return t&&new Date(t.getTime())},this.toObject=function(t){let e=(t=t||n).getDay(),r=""+t.getFullYear(),i={yyyy:+r,y:+r.substr(0,2),yy:+r.substr(-2),m:t.getMonth(),d:t.getDate()};return i.mmm=v.monthNamesShort[i.m],i.mmmm=v.monthNames[i.m],i.mm=a(++i.m),i.ddd=v.dayNamesShort[e],i.dddd=v.dayNames[e],i.dd=a(i.d),i.h=t.getHours(),i.hh=a(i.h),i.M=t.getMinutes(),i.MM=a(i.M),i.s=t.getSeconds(),i.ss=a(i.s),i.ms=t.getMilliseconds(),i.t=i.h<12?"a":"p",i.tt=i.t+"m",i},this.getCentury=function(t){return u((t||n).getFullYear()/100)},this.startYear=function(t){return t&&t.setFullYear(t.getFullYear(),0,1),e},this.startMonth=function(t){return t&&t.setFullYear(t.getFullYear(),t.getMonth(),1),e},this.daysInMonth=function(t){return c((t=t||n).getFullYear(),t.getMonth())},this.dayOfYear=function(t){return e=(t=t||n).getFullYear(),r=t.getMonth(),u=t.getDate(),i.slice(0,r).reduce((t,e)=>t+e,u+(r>1&&s(e)));var e,r,u},this.daysInYear=function(t){return s((t||n).getFullYear())?366:365},this.weekOfYear=function(t){return Math.ceil((D(t.getFullYear(),0)+e.dayOfYear(t))/7)},this.weekOfMonth=function(t){return Math.ceil((D(t.getFullYear(),t.getMonth())+t.getDate())/7)},this.endDay=function(t){return t&&t.setHours(23,59,59,999),e},this.format=function(t,e){return M(e||"@yyyy;-@mm;-@dd;",t)},this.minTime=p,this.isoTime=b,this.shortTime=function(t){return M("@h;:@MM; @tt;",t)},this.minDate=function(t){return M("@yy;@mm;@dd;",t)},this.shortDate=function(t){return M("@yy;-@m;-@d;",t)},this.isoDate=function(t){return v.isoDate(t)},this.isoDateTime=function(t){return v.isoDateTime(t)},this.dfIso=function(t){return e.isoDate(t)+"T"+e.isoTime(t)+"."+t.getMilliseconds()+"Z"},this.dfFull=function(t){return M("@dddd;, @mmmm; @d;, @yyyy;",t)},this.toJSON=e.dfIso,this.toDate=function(t){return v.toDate(t)},this.helper=function(t){return v.helper(t)},this.trIsoDate=function(t){return v.trIsoDate(t)},this.acDate=function(t){return v.acDate(t)},this.acTime=function(t){return t?b((e=r,n=l(t),d(e,n[0],n[1],n[2],n[3]))):t;var e,n},this.tHelper=function(t){return t&&t.replace(/(\d\d)(\d+)$/g,"$1:$2").replace(/[^\d\:]/g,"")},this.addMilliseconds=function(t,n){return t&&t.setMilliseconds(t.getMilliseconds()+n),e},this.addHours=function(t,n){return t&&t.setHours(t.getHours()+n),e},this.addDays=function(t,n){return t&&t.setDate(t.getDate()+n),e},this.addDate=e.addDays,this.toArray=function(t){return[t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]};const A=[0,12,0,24,60,60,1e3];this.diff=function(t,r){if(t>(r=r||n))return e.diff(r,t);var i=e.toArray(r);return A[2]=e.daysInMonth(t)-t.getDate()+r.getDate(),e.toArray(t).forEach((t,e)=>{!function t(e,n,r){e[n]-=r,e[n]<0&&(e[n]+=A[n],t(e,n-1,1))}(i,e,t)}),i},this.diffDays=function(t,e){return e?Math.abs(e.getTime()-t.getTime())/864e5:0},this.diffHours=function(t,e){return e?Math.abs(e.getTime()-t.getTime())/36e5:0},this.inYear=function(t,e){return t&&e&&t.getFullYear()==e.getFullYear()},this.inMonth=function(t,n){return e.inYear(t,n)&&t.getMonth()==n.getMonth()},this.inWeek=function(t,n){return e.inMonth(t,n)&&e.weekOfYear(t)==e.weekOfYear(n)},this.inDay=function(t,n){return e.inMonth(t,n)&&t.getDate()==n.getDate()},this.inHour=function(t,n){return e.inDay(t,n)&&t.getHours()==n.getHours()},this.between=function(t,e,n){return n=n||t,(e=e||t)<=t&&t<=n},this.range=function(t,e,n){return e&&t<e?e:n&&n<t?n:t},this.rand=function(t,e){let n=t.getTime();return new Date(u(Math.random()*(e.getTime()-n)+n))},this.min=function(t,e){return t&&e?t<e?t:e:o(t,e)},this.max=function(t,e){return t&&e?t<e?e:t:o(t,e)},Date.prototype.toJSON=function(){return e.dfIso(this)},e.setI18n(t)}function MessageBox(t){const e=this,n={en:{required:"Required field!",minlength:"Minlength = @minlength;",maxlength:"Maxlength exceded",email:"Wrong Mail format",regex:"Wrong format",number:"Wrong number format",min:"Min value = @min;",max:"Max value exceded",range:"Value out of range",digits:"Not numeric value",date:"Wrong date format",mindate:"Min date = @mindate;",maxdate:"Max date exceded",time:"Wrong time",opok:"Action executed successfully",operr:"Error on execute action",form:"Form validation failed",remove:"Are you sure to delete element?",cancel:"Are you sure to cancel element?"},es:{required:"Campo obligatorio!",minlength:"Longitud m&iacute;nima = @minlength;",maxlength:"Longitud m&aacute;xima excedida",email:"Formato de E-Mail incorrecto",regex:"Formato incorrecto",number:"Formato n&uacute;merico incorrecto",min:"Valor m&iacute;nimo = @min;",max:"Valor m&aacute;ximo excedido",range:"Valor fuera del rango permitido",digits:"Valor no n&uacute;merico",date:"Formato de fecha incorrecto",mindate:"Fecha m&iacute;nima = @mindate;",maxdate:"Fecha m&aacute;xima excedida",time:"Hora incorrecta",opok:"Operaci&oacute;n realizada correctamente",operr:"Error al ejecutar la operaci&oacute;n",form:"El formulario contiene campos erroneos",remove:"¿Confirma que desea eliminar este registro?",cancel:"¿Confirma que desea cancelar este registro?"}};var r=n.es;this.getLang=function(t){return t?n[t]:r},this.setLang=function(t,r){return n[t]=r,e},this.getI18n=function(t){return n[t]||t&&n[t.substr(0,2)]||n.es},this.setI18n=function(t){return r=e.getI18n(t),e},this.addLang=function(t,n){return Object.assign(e.getLang(n),t),e},this.get=function(t){return r[t]},this.set=function(t,n){return r[t]=n,e},this.format=function(t){return t.replace(/@(\w+);/g,(t,e)=>nvl(r[e],t))},e.setI18n(t)}function NumberBox(t){const e=this,n=/\D+/g,r="",i=".";function u(t,e){return isNaN(t)?e:t}function o(t){return parseInt(t)||0}function a(t){return t&&"false"!==t&&"0"!==t}function s(t,e){return e=u(e,2),+(Math.round(t+"e"+e)+"e-"+e)}function c(t,e){for(var n=[],r=function(t){return t?o(t.length):0}(t);r>e;r-=e)n.unshift(t.substr(r-e,e));return r>0&&n.unshift(t.substr(0,r)),n}function l(t,e,n,o){if(void 0===(a=t)||null==a)return r;var a;o=u(o,2);var l=n&&o>0,f=t<0?"-":r,h=s(t,o).toString(),d=(h=(t<0?h.substr(1):h)||"0").lastIndexOf(i);return f+(d<0?c(h,3).join(e)+(l?n+"0".repeat(o):r):c(h.substr(0,d),3).join(e)+(l?n+h.substr(d+1).padEnd(o,"0"):r))}function f(t,e,u){if(!t)return 0;var o=t.lastIndexOf(e),a="-"==t.charAt(0)?"-":r;return s(parseFloat(a+(o<0?t.replace(n,r):t.substr(0,o).replace(n,r)+i+t.substr(o+1))),u)}const h={en:{toFloat:function(t){return f(t,i)},float:function(t,e){return l(t,",",i,e)},integer:function(t){return l(t,",",i,0)},trIsoFloat:function(t,e){return t?this.float(parseFloat(t),e):t},trIsoInt:function(t){return t?this.integer(parseFloat(t)):t},helper:function(t,e){return t&&this.float(this.toFloat(t),e)},boolval:function(t){return a(t)?"Yes":"No"}},es:{toFloat:function(t){return f(t,",")},float:function(t,e){return l(t,i,",",e)},integer:function(t){return l(t,i,",",0)},trIsoFloat:function(t,e){return t?this.float(parseFloat(t),e):t},trIsoInt:function(t){return t?this.integer(parseFloat(t)):t},helper:function(t,e){return t&&this.float(this.toFloat(t),e)},boolval:function(t){return a(t)?"Sí":"No"}}};var d=h.es;this.getLang=function(t){return t?h[t]:d},this.setLang=function(t,n){return h[t]=n,e},this.getI18n=function(t){return h[t]||t&&h[t.substr(0,2)]||h.es},this.setI18n=function(t){return d=e.getI18n(t),e},this.intval=o,this.floatval=function(t){return parseFloat(t)||0},this.toFloat=function(t){return d.toFloat(t)},this.float=function(t,e){return d.float(t,e)},this.integer=function(t){return d.integer(t)},this.trIsoFloat=function(t,e){return d.trIsoFloat(t,e)},this.trIsoInt=function(t){return d.trIsoInt(t)},this.helper=function(t,e){return d.helper(t,e)},this.boolval=function(t){return d.boolval(t)},this.gt0=function(t){return dNan(t,0)>0},this.le0=function(t){return isNaN(t)||t<=0},this.between=function(t,e,n){return e=u(e,t),n=u(n,t),e<=t&&t<=n},this.range=function(t,e,n){return Math.max(Math.min(t,n),e)},this.rand=function(t,e){return Math.random()*(e-t)+t},this.round=s,e.setI18n(t)}function StringBox(){const t=this,e="àáâãäåāăąÀÁÂÃÄÅĀĂĄÆßèéêëēĕėęěÈÉĒĔĖĘĚìíîïìĩīĭÌÍÎÏÌĨĪĬòóôõöōŏőøÒÓÔÕÖŌŎŐØùúûüũūŭůÙÚÛÜŨŪŬŮçÇñÑþÐŔŕÿÝ",n="aaaaaaaaaAAAAAAAAAABeeeeeeeeeEEEEEEEiiiiiiiiIIIIIIIIoooooooooOOOOOOOOOuuuuuuuuUUUUUUUUcCnNdDRryY";function r(t){return"string"==typeof t||t instanceof String}function i(t){return r(t)?t.trim():t}function u(t){return t?t.length:0}function o(t){return a(i(t)).toLowerCase()}function a(t){for(var r="",i=u(t),o=0;o<i;o++){var a=t.charAt(o),s=e.indexOf(a);r+=s<0?a:n.charAt(s)}return r}this.tr=a,this.isstr=r,this.trim=i,this.size=u,this.eq=function(t,e){return o(t)==o(e)},this.indexOf=function(t,e){return t?t.indexOf(e):-1},this.iIndexOf=function(t,e){return o(t).indexOf(o(e))},this.prevIndexOf=function(t,e,n){return t?t.substr(0,n).lastIndexOf(e):-1},this.prefix=function(t,e){return t.startsWith(e)?t:e+t},this.suffix=function(t,e){return t.endsWith(e)?t:t+e},this.trunc=function(t,e){return u(t)>e?t.substr(0,e).trim()+"...":t},this.itrunc=function(e,n){var r=u(e)>n?t.prevIndexOf(e," ",n):-1;return t.trunc(e,r<0?n:r)},this.removeAt=function(t,e,n){return e<0?t:t.substr(0,e)+t.substr(e+n)},this.insertAt=function(t,e,n){return t?t.substr(0,n)+e+t.substr(n):e},this.replaceAt=function(t,e,n,r){return n<0?t:t.substr(0,n)+e+t.substr(n+r)},this.replaceLast=function(t,e,n){return t?t.replaceAt(t.lastIndexOf(e),e.length,n):n},this.wrapAt=function(e,n,r,i,u){return n<0?e:t.insertAt(t.insertAt(e,i,n),u,n+i.length+r)},this.iwrap=function(e,n,r,i){return t.wrapAt(e,t.iIndexOf(e,n),e.length,r||"<u><b>",i||"</u></b>")},this.rand=function(t){return Math.random().toString(36).substr(2,t||8)},this.lopd=function(t){return t?"***"+t.substr(3,4)+"**":t},this.split=function(t,e){return t?t.trim().split(e||","):[]},this.minify=function(t){return t?t.trim().replace(/\s{2}/g,""):t},this.lines=function(e){return t.split(e,/[\n\r]+/)},this.words=function(e){return t.split(e,/\s+/)},this.ilike=function(e,n){return t.iIndexOf(""+e,n)>-1},this.olike=function(e,n,r){return n.some(function(n){return t.ilike(e[n],r)})},this.alike=function(e,n,r){return t.words(r).some(function(r){return t.olike(e,n,r)})},this.ltr=function(t,e){for(var n=[],r=u(t);r>e;r-=e)n.unshift(t.substr(r-e,e));return r>0&&n.unshift(t.substr(0,r)),n},this.rtl=function(t,e){for(var n=[],r=u(t),i=0;i<r;i+=e)n.push(t.substr(i,e));return n},this.slices=function(t,e){var n=0,r=[],i=u(t);for(let u=0;n<i&&u<e.length;u++){let i=e[u];r.push(t.substr(n,i)),n+=i}return n<i&&r.push(t.substr(n)),r}}function ValidateBox(t){const e=this;function n(t){return t?t.length:0}function r(t,e){try{return!e||t.test(e)}catch(t){}return!1}t=Object.assign({},{errInputClass:"is-invalid",RE_DIGITS:/^\d+$/,RE_IDLIST:/^\d+(,\d+)*$/,RE_MAIL:/\w+[^\s@]+@[^\s@]+\.[^\s@]+/,RE_LOGIN:/^[\w#@&°!§%;:=\^\/\(\)\?\*\+\~\.\,\-\$]{6,}$/,RE_IPv4:/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/,RE_IPv6:/^([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}$/,RE_SWIFT:/^[A-Z]{6,6}[A-Z2-9][A-NP-Z0-9]([A-Z0-9]{3,3}){0,1}$/,RE_URL:/(http|fttextp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,RE_DNI:/^(\d{8})([A-Z])$/,RE_CIF:/^([ABCDEFGHJKLMNPQRSUVW])(\d{7})([0-9A-J])$/,RE_NIE:/^[XYZ]\d{7,8}[A-Z]$/,validators:{}},t),this.getConfig=function(){return t},this.setConfig=function(e){return Object.assign(t,e),this},this.required=function(t){return!!t},this.size=function(t,e,r){let i=n(t);return e<=i&&i<=r},this.regex=function(t,e){return r(t,e)},this.login=function(e){return r(t.RE_LOGIN,e)},this.email=function(e){return r(t.RE_MAIL,e)},this.digits=function(e){return r(t.RE_DIGITS,e)},this.idlist=function(e){return r(t.RE_IDLIST,e)},this.array=function(t){return!t||Array.isArray(t)},this.esId=function(n){return r(t.RE_DNI,n)?e.dni(n):r(t.RE_CIF,n)?e.cif(n):!!r(t.RE_NIE,n)&&e.nie(n)},this.dni=function(t){return"TRWAGMYFPDXBNJZSQVHLCKE".charAt(parseInt(t,10)%23)==t.charAt(8)},this.cif=function(e){for(var n=e.match(t.RE_CIF),r=n[1],i=n[2],u=n[3],o=0,a=0;a<i.length;a++){var s=parseInt(i[a],10);a%2==0&&(s=(s*=2)<10?s:parseInt(s/10)+s%10),o+=s}var c=0!==(o%=10)?10-o:o,l="JABCDEFGHI".substr(c,1);return r.match(/[ABEH]/)?u==c:r.match(/[KPQS]/)?u==l:u==c||u==l},this.nie=function(t){var n=t.charAt(0),r="X"==n?0:"Y"==n?1:"Z"==n?2:n;return e.dni(r+t.substr(1))},this.iban=function(t){if(24!=n(t=t.toUpperCase().trim().replace(/\s+/g,"")))return!1;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let r=e.search(t.substring(0,1))+10,i=e.search(t.substring(1,2))+10,u=String(r)+String(i)+t.substring(2);u=u.substring(6)+u.substring(0,6);var o="",a=Math.ceil(u.length/7);for(let t=1;t<=a;t++)o=String(parseFloat(o+u.substr(7*(t-1),7))%97);return 1==o},this.generatePassword=function(t,e){return e=e||"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_#@&°!§%;:=^/()?*+~.,-$",Array.apply(null,Array(t||10)).map(function(){return e.charAt(Math.random()*e.length)}).join("")},this.testPassword=function(t){let e=0;return e+=/[A-Z]+/.test(t)?1:0,e+=/[a-z]+/.test(t)?1:0,e+=/[0-9]+/.test(t)?1:0,e+=/[\W]+/.test(t)?1:0,e+=e>2&&n(t)>8},this.get=function(e){return e?t.validators[e]:t.validators},this.set=function(n,r){return t.validators[n]=r,e},this.add=function(n){return Object.assign(t.validators,n),e},this.values=function(t,e){e=e||{};let r=n(t);for(let n=0;n<r;n++){let r=t[n];e[r.name]=r.value}return e},this.each=function(t,n){return Array.prototype.forEach.call(t,n),e},this.find=function(t,e){return Array.prototype.find.call(t,t=>t.matches(e))},this.filter=function(t,e){return Array.prototype.filter.call(t,t=>t.matches(e))},this.focus=function(t){t=t||document.body.querySelectorAll("input,select,textarea");let n=e.find(t,":not([type=hidden])[tabindex]:not([readonly])");return n&&n.focus(),e},this.reset=function(t){return e.each(t,t=>{t.value=""})},this.validate=function(e,r){r=r||t.validators;let i=!0,u=n(e);for(let n=0;n<u;n++){let u=e[n],o=r[u.id];o&&!o(u.value,u)?(u.classList.add(t.errInputClass),i&&u.focus(),i=!1):u.classList.remove(t.errInputClass)}return i},this.fetch=function(t,r,i){const u="application/x-www-form-urlencoded",o={method:"get",headers:{"Content-Type":u}};let a=new FormData,s=n(r);for(let t=0;t<s;t++){let e=r[t];a.append(e.name,e.value)}for(let t in i)a.append(t,i[t]);let c=t.closest("form");return c?(o.method=c.getAttribute("method")||"get",o.headers["Content-Type"]=c.getAttribute("enctype")||u,o.body="multipart/form-data"==o.headers["Content-Type"]?a:new URLSearchParams(a),o.url=t.href||c.getAttribute("action")):(o.body=new URLSearchParams(a),o.url=t.href),fetch(o.url,o).then(t=>(t.ok&&e.reset(r),e.focus(r),t))}}$(document).ready(function(){let t=navigator.language||navigator.userLanguage,e=new DateBox(t),n=new NumberBox(t),r=new MessageBox(t),i=new ValidateBox,u=new StringBox;$("ul#menu").each(function(t,e){$(e.children).filter("[parent][parent!='']").each((t,n)=>{let r=$("#"+$(n).attr("parent"),e);r.children().last().is(e.tagName)||r.append('<ul class="sub-menu"></ul>'),r.children().last().append(n)});let n=$("li>ul",e).find("ul.sub-menu").prev().append(' <b class="nav-tri">&rtrif;</b>').find("b.nav-tri");$(e.children).remove("[parent][parent!='']"),$("a.nav-link").hover(function(){n.html("&rtrif;"),$("b.nav-tri",this).html("&dtrif;"),$(this).parents("ul.sub-menu").each(function(){$(this).prev().find("b.nav-tri").html("&dtrif;")})}).filter("[disabled]").each(function(){let t=parseInt(this.getAttribute("disabled"))||0;$(this).toggleClass("disabled",3!=(3&t))}).removeAttr("disabled")}).children().fadeIn(200);let o=document.querySelectorAll(".boolean");$(document.querySelectorAll("input.float")).change(function(){this.value=n.helper(this.value)}),$(o).filter("input").each(function(){this.value=n.boolval(this.value)}),$(o).not("input").each(function(){this.innerText=n.boolval(this.innerText)}),$(document.querySelectorAll("input.date")).keyup(function(){this.value=e.helper(this.value)}).change(function(){this.value=e.acDate(this.value)}),$(document.querySelectorAll("input.time")).keyup(function(){$(this).val(e.tHelper(this.value))}).change(function(){this.value=e.acTime(this.value)}),$.datepicker.regional.es=e.getI18n("es"),$.datepicker.setDefaults(e.getLang()),$(".datepicker").datepicker();let a=$("div.alert").each(function(t,e){$(".alert-text:not(:empty)",e).length&&$(e).removeClass("d-none"),$("button",e).click(function(){return!$(e).addClass("d-none")})});function s(){$(this).siblings(".clear-input").toggleClass("d-none",!this.value)}function c(){$("#counter-"+this.id).text(Math.abs(this.getAttribute("maxlength")-u.size(this.value)))}function l(t){return!a.addClass("d-none").filter(".alert-danger").removeClass("d-none").find(".alert-text").html(t)}function f(t){return!a.addClass("d-none").filter(".alert-success").removeClass("d-none").find(".alert-text").html(t)}function h(t,e){return!$(t).siblings(".invalid-feedback").html(r.get(e))}function d(t,e){return t||h(e,"required")}function m(t){return t.nif+" - "+t.nombre}function g(t,e){return $(t).siblings("[type=hidden]").val(e&&e.idUsuario),this}$(".clear-input").click(function(){$(this).addClass("d-none").siblings("input").val("").focus()}).siblings("input").each(s).keyup(s),$("textarea[maxlength]").keyup(c).each(c);const p={source:!1,ac1:{url:"/usuarios.html",select:g,render:m},ac2:{url:"/usuarios.html",select:g,render:m}};let b,y=$(".autocomplete").autocomplete({minLength:3,source:function(t,e){let n=$(".loading").show();fetch(b.url+"?term="+t.term,{method:"GET"}).then(t=>t.json()).then(t=>{e(t.slice(0,10))}).catch(l).finally(()=>n.fadeOut())},focus:function(){return!1},search:function(t,e){return p.source},select:function(t,e){return!$(this).val(b.select(this,e.item).render(e.item))}}).keydown(function(t){b=p[this.id],p.source=8==t.keyCode||46==t.keyCode?!!b.select(this):47<t.keyCode&&t.keyCode<171});y.length&&(y.autocomplete("instance")._renderItem=function(t,e){return $("<li></li>").append("<div>"+b.render(e)+"</div>").appendTo(t)}),i.add({usuario:d,clave:d,newPass:d,oldPass:d,rePass:d,nombre:d,asunto:d,info:d,number:(t,e)=>{if(!t)return h(e,"required");let r=n.toFloat(t);return isNaN(r)?h(e,"number"):!!n.between(r,6.7,18.3)||h(e,"range")},date:function(t,n){if(!t)return h(n,"required");let r=e.toDate(t);return e.valid(r)?e.sysdate()>r||h(n,"range"):h(n,"date")},nif:(t,e)=>d(t,e)&&(i.esId(t.toUpperCase())||h(e,"regex"))}).set("email",(t,e)=>d(t,e)&&(i.email(t,e)||h(e,"regex"))).focus(),$("form").submit(function(t){return $(this.querySelectorAll(".invalid-feedback")).text(""),i.validate(this.elements)?$(".loading").show():l(r.get("form"))}).each(function(){$(this.querySelectorAll(".invalid-feedback:not(:empty)")).siblings(":input").addClass("is-invalid");let t={},e=this.elements;$(".ajax-submit",this).click(function(n){if(n.preventDefault(),i.validate(e)){let r=$(".loading").show(),u=t[this.id]||f;grecaptcha&&this.classList.contains("captcha")?grecaptcha.ready(function(){grecaptcha.execute("6LeDFNMZAAAAAKssrm7yGbifVaQiy1jwfN8zECZZ",{action:"submit"}).then(t=>i.fetch(n.target,e,{token:t}).finally(()=>r.fadeOut())).then(t=>t.ok?t.text().then(u):t.text().then(l)).catch(l)}):i.fetch(this,e).then(t=>t.ok?t.text().then(u):t.text().then(l)).catch(l).finally(()=>r.fadeOut())}})});let v=$("#back-to-top").click(function(){return!$("body,html").animate({scrollTop:0},400)});$(window).scroll(function(){$(this).scrollTop()>50?v.fadeIn():v.fadeOut()}),document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();try{document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth"})}catch(t){}})})});